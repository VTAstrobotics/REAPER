# FROM ubuntu:18.04
FROM ros:humble-ros-base-jammy

RUN apt-get update && apt-get install -y \
        git \
        jq \
        wget \
        xz-utils

# install clang-format version 16
RUN apt-get install -y lsb-release \
    wget \
    software-properties-common \
    gnupg \
    && wget https://apt.llvm.org/llvm.sh \
    && chmod +x llvm.sh \
    && ./llvm.sh 16 \
    && apt-get install -y clang-format-16 \
    && ln -s $(which clang-format-16) /usr/local/bin/clang-format

COPY .clang-format /
# COPY .clang-tidy /

COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

# Add nonroot user with same UID and GID as your host system
# (copied from https://code.visualstudio.com/remote/advancedcontainers/add-nonroot-user#_creating-a-nonroot-user)
ARG USERNAME=astro-dev
ARG USER_UID=1000
ARG USER_GID=$USER_UID
RUN groupadd --gid $USER_GID $USERNAME \
    && useradd -s /bin/bash --uid $USER_UID --gid $USER_GID -m $USERNAME \
    && apt-get update \
    && apt-get install -y sudo \
    && echo $USERNAME ALL=\(root\) NOPASSWD:ALL > /etc/sudoers.d/$USERNAME \
    && chmod 0440 /etc/sudoers.d/$USERNAME
# Switch from root to user
USER $USERNAME

# Add user to video group to allow access to webcam
RUN sudo usermod --append --groups video $USERNAME

ENTRYPOINT ["/entrypoint.sh"]
